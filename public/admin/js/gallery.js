'use strict';
// Gallery multi-upload & previews extracted
(function(){
  function init(){ const modalBtn=document.getElementById('multiUploadBtn'); const modalEl=document.getElementById('multiUploadModal'); const dropzone=document.getElementById('dropzone'); const input=document.getElementById('imagesInput'); const preview=document.getElementById('previewList'); const uploadBtn=document.getElementById('uploadBtn'); if(!dropzone||!input||!preview) return; let files=[]; function refresh(){ preview.innerHTML=''; if(!files.length){ uploadBtn.disabled=true; return;} uploadBtn.disabled=false; files.slice(0,15).forEach((f,i)=>{ const col=document.createElement('div'); col.className='col-6 col-md-3'; const wrap=document.createElement('div'); wrap.className='position-relative border rounded small p-1 bg-white'; const rm=document.createElement('button'); rm.type='button'; rm.className='btn btn-sm btn-danger position-absolute top-0 end-0 translate-middle badge rounded-pill'; rm.innerHTML='&times;'; rm.onclick=()=>{ files.splice(i,1); refresh(); }; const img=document.createElement('img'); img.className='img-fluid rounded'; img.style.objectFit='cover'; img.style.height='90px'; const reader=new FileReader(); reader.onload=e=>{ img.src=e.target.result; }; reader.readAsDataURL(f); wrap.appendChild(rm); wrap.appendChild(img); col.appendChild(wrap); preview.appendChild(col); }); }
    function handle(list){ Array.from(list).forEach(f=>{ if(!f.type.match(/^image\//)) return; if(files.length>=15) return; files.push(f); }); const dt=new DataTransfer(); files.forEach(f=>dt.items.add(f)); input.files=dt.files; refresh(); }
    modalBtn && modalBtn.addEventListener('click',()=>{ const bsModal=new bootstrap.Modal(modalEl); bsModal.show(); }); ['dragenter','dragover'].forEach(evt=> dropzone.addEventListener(evt,e=>{ e.preventDefault(); dropzone.classList.add('border-primary','bg-white'); })); ['dragleave','drop'].forEach(evt=> dropzone.addEventListener(evt,e=>{ e.preventDefault(); dropzone.classList.remove('border-primary','bg-white'); })); dropzone.addEventListener('click',()=> input.click()); dropzone.addEventListener('drop',e=> handle(e.dataTransfer.files)); input.addEventListener('change',e=> handle(e.target.files)); }
  if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', init); else init();
})();
